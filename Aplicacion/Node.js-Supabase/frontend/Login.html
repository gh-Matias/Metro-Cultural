<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Metro Cultural - Plataforma de eventos culturales</title>
  <link rel="stylesheet" href="login.css">
  <link rel="stylesheet" href="hamburguesa.css">
  <!-- Agregamos Tailwind para que las clases de la función showMessage()  funcione -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <header id="menu-container"></header>

  <div class="login-container">
    <div class="login-header">
      <h2 class="section-title">Inicio de sesión</h2>
    </div>

    <form class="login-form" id="loginForm">
      <div class="input-group">
        
        <div id="message-status" class="hidden text-center mx-auto mb-4 p-2 rounded-lg transition-all duration-300" style="max-width: 90%;">
          <!-- Los mensajes de éxito o error se insertarán aquí por el JS -->
        </div>
     
        <label for="email">Correo</label>
        <input type="email" id="email" placeholder="Email" required><br><br>
        <label for="password">Contraseña</label>
        <input type="password" id="password" placeholder="Password" required><br><br>
        <div class="forgot">
          <div class="forgot-password">
            <a href="#">¿Olvidaste tu contraseña?</a>
          </div>
        </div>
        <button type="submit" class="login-btn">Ingresar</button>
        <div class="signup-link">
          ¿No tienes una cuenta? <a href="registro.html">Regístrate</a>
          <br>
          <h2>o</h2>
          
          <a href="lineas.html" >Ingresar sin cuenta</a>
        </div>
        
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const client = supabase.createClient("https://jgiwhiccqbzeffyndsbf.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpnaXdoaWNjcWJ6ZWZmeW5kc2JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyNzM1MDIsImV4cCI6MjA3NTg0OTUwMn0.Q7qh7dODhSTFTKvOmwrkA9mYkbxAhDK28AyaVdJjCk4"
    );
  </script>

  <script>
    // Menu amborguesa
    fetch("hamburguesa.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("menu-container").innerHTML = data;

        // Esperar un instante para que DOM cargue bien
        setTimeout(() => {
          activarHamburguesa();
          controlarBotonesSesion();
          asignarLogout();
        }, 50);
      });

    function activarHamburguesa() {
      const hamburger = document.getElementById("hamburger");
      const navLinks = document.getElementById("navLinks");
      if (!hamburger || !navLinks) return;
      hamburger.addEventListener("click", () => navLinks.classList.toggle("show"));
    }

    async function controlarBotonesSesion() {
      const { data: { session } } = await client.auth.getSession();

      const loginBtn = document.querySelector('.nav-links a[href="Login.html"]');
      const logoutBtn = document.getElementById("btn-logout");

      if (!loginBtn || !logoutBtn) return;

      if (session) {
        loginBtn.style.display = "none";
        logoutBtn.style.display = "block";
      } else {
        loginBtn.style.display = "block";
        logoutBtn.style.display = "none";
      }
    }

    function asignarLogout() {
      const logoutBtn = document.getElementById("btn-logout");
      if (!logoutBtn) return;

      logoutBtn.addEventListener("click", async () => {
        await client.auth.signOut();

        localStorage.removeItem("access_token");
        localStorage.removeItem("refresh_token");
        localStorage.removeItem("user");

        window.location.href = "Login.html";
      });
    }
  </script>
  
  <script src="Login.js"></script>

</body>
</html>
