<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Metro Cultural - Plataforma de eventos culturales</title>
  <link rel="stylesheet" href="lugar.css">
  <link rel="stylesheet" href="hamburguesa.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
  <header id="menu-container"></header>
  <div class="container">
    <h1 id="nombre-lugar">Cargando...</h1>
    <img id="imagen-lugar" src="" alt="Imagen del lugar" class="evento-img" style="display:none;">
    <p><strong>Dirección</strong> <span id="direccion" class="texto-inline"></span></p>
    <p><strong>Horario</strong> <span id="horario" class="texto-inline"></span></p>
    <p><strong>Descripción</strong></p><p id="descripcion" class="texto-izq"></p>

    <!-- Botón favorito -->
     <span id="favorito-texto" class="favorito-text">Añadir a favoritos</span>
    <button id="btn-favorito" class="favorito-btn">⭐</button>


    <div class="botones-nav">
      <a href="estaciones.html" class="volver">⬅ Volver</a>
      <a href="menu.html" class="volver">Continuar ➡</a>
    </div>

  </div>
  

  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const supabase = window.supabase.createClient(
      "https://jgiwhiccqbzeffyndsbf.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpnaXdoaWNjcWJ6ZWZmeW5kc2JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyNzM1MDIsImV4cCI6MjA3NTg0OTUwMn0.Q7qh7dODhSTFTKvOmwrkA9mYkbxAhDK28AyaVdJjCk4"
    );

    async function cargarLugar() {
      const estacionId = localStorage.getItem("estacionSeleccionada");

      if (!estacionId) {
        document.getElementById("nombre-lugar").textContent = "No se seleccionó ninguna estación.";
        return;
      }

      const { data, error } = await supabase
        .from("lugar_cultural")
        .select("*")
        .eq("estacion_id", estacionId)
        .single();

      if (error || !data) {
        console.error("Error al cargar lugar:", error);
        document.getElementById("nombre-lugar").textContent = "No se encontró información para esta estación.";
        return;
      }

      // Mostrar datos
      document.getElementById("nombre-lugar").textContent = data.nombre_lugar;
      document.getElementById("direccion").textContent = data.direccion_cultural;
      document.getElementById("horario").textContent = `${data.horario_apertura} - ${data.horario_cierre}`;
      document.getElementById("descripcion").textContent = data.descripcion_cultural;


      // Imagen
      const img = document.getElementById("imagen-lugar");
      if (data.imagen_url) {
        img.src = data.imagen_url;
        img.style.display = "block";
      }

      // Guardar ID del lugar
      document.getElementById("btn-favorito").dataset.lugarId = data.id;
    }

    cargarLugar();
  </script>
  <script>
fetch("hamburguesa.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("menu-container").innerHTML = data;

    // Esperar un instante para que DOM esté listo
    setTimeout(() => {
      activarHamburguesa();
      controlarBotonesSesion();
      asignarLogout();
    }, 50);
  });

function activarHamburguesa() {
  const hamburger = document.getElementById("hamburger");
  const navLinks = document.getElementById("navLinks");
  if (!hamburger || !navLinks) return;
  hamburger.addEventListener("click", () => navLinks.classList.toggle("show"));
}

async function controlarBotonesSesion() {
  const { data: { session } } = await supabase.auth.getSession();

  const loginBtn = document.querySelector('.nav-links a[href="Login.html"]');
  const logoutBtn = document.getElementById("btn-logout");

  if (!loginBtn || !logoutBtn) return;

  if (session) {
    loginBtn.style.display = "none";
    logoutBtn.style.display = "block";
  } else {
    loginBtn.style.display = "block";
    logoutBtn.style.display = "none";
  }
}

function asignarLogout() {
  const logoutBtn = document.getElementById("btn-logout");
  if (!logoutBtn) return;

  logoutBtn.addEventListener("click", async () => {
    await client.auth.signOut();

    localStorage.removeItem("access_token");
    localStorage.removeItem("refresh_token");
    localStorage.removeItem("user");

    window.location.href = "Login.html";
  });
}
</script>

  <script src="favoritos.js"></script>
</body>
</html>

